!function e(t,a,n){function l(r,s){if(!a[r]){if(!t[r]){var o="function"==typeof require&&require;if(!s&&o)return o(r,!0);if(i)return i(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var c=a[r]={exports:{}};t[r][0].call(c.exports,function(e){var a=t[r][1][e];return l(a?a:e)},c,c.exports,e,t,a,n)}return a[r].exports}for(var i="function"==typeof require&&require,r=0;r<n.length;r++)l(n[r]);return l}({1:[function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),u=e("react"),c=n(u),d=e("react-dom"),m=n(d),f=[{id:"fee_slow",name:"话费慢充"},{id:"jyk",name:"加油卡"},{id:"service_jyk",name:"客服加油卡"}],p={fee_slow:[{id:"100",name:"100"},{id:"200",name:"200"},{id:"300",name:"300"},{id:"500",name:"500"},{id:"1000",name:"1000"},{id:"2000",name:"2000"},{id:"3000",name:"3000"},{id:"4000",name:"4000"},{id:"5000",name:"5000"},{id:"10000",name:"10000"}],jyk:[{id:"1000",name:"1000"},{id:"2000",name:"2000"},{id:"3000",name:"3000"},{id:"4000",name:"4000"},{id:"5000",name:"5000"},{id:"6000",name:"6000"},{id:"7000",name:"7000"},{id:"8000",name:"8000"},{id:"9000",name:"9000"},{id:"10000",name:"10000"}],service_jyk:[{id:"500",name:"500"},{id:"1000",name:"1000"},{id:"3000",name:"3000"},{id:"5000",name:"5000"},{id:"10000",name:"10000"},{id:"20000",name:"20000"}]},h={fee_slow:"话费慢充",jyk:"加油卡",service_jyk:"客服加油卡"},v=function(e){function t(){i(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.state={s_view:!1,start:!1,list:[],o_list:[]},e.handleConfig("all"),e}return s(t,e),o(t,[{key:"handleSubmitData",value:function(e){var t=this,a=this.state.list;a[e].timestamp=(new Date).getTime(),$.post("/api/qrcode/submit",JSON.stringify(a[e])).done(function(n){console.log(n);var l=JSON.parse(n),i=l.status,r=l.order_id;"ok"===i?(a[e].order_id=r,a[e].status=!0,clearTimeout(a[e].img_task),a[e].img_task=null,t.loadCodeImage(e,r),console.log(a),t.setState({list:a})):alert("创建订单失败")}).fail(function(){alert("创建订单异常")})}},{key:"handleConfig",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state.list;$.post("/api/qrcode/config",JSON.stringify({type:e,data:a})).done(function(e){var a=JSON.parse(e),n=a.status,l=a.data;return"ok"!==n?(alert("加载配置失败"),!1):void t.setState({list:l,o_list:l})}).fail(function(){return alert("加载配置异常"),!1})}},{key:"loadCodeImage",value:function(e,t){var a=this,n=this.state.list,l=null;$.post("/api/qrcode/qrcode_get",JSON.stringify({order_id:t})).done(function(i){var r=JSON.parse(i),s=r.status,o=r.image;return"ok"===s?(n[e].image=o,n[e].status=!1,a.setState({list:n}),!1):(l=setTimeout(a.loadCodeImage.bind(a,e,t),6e4),n[e].img_task=l,a.setState({list:n}),void 0)}).fail(function(){return alert("获取图片异常"),!1})}},{key:"onClearInterval",value:function(e){var t=this.state.list;clearInterval(t[e].task),clearTimeout(t[e].img_task),t[e].task=null,t[e].img_task=null,t[e].status=!1,this.setState({list:t})}},{key:"onIntervalTask",value:function(e){var t=this.state.list;this.handleSubmitData(e),t[e].task=setInterval(this.handleSubmitData.bind(this,e),18e4),this.setState({list:t})}},{key:"onStartBatchTask",value:function(){var e=this.state.list;for(var t in e)clearInterval(e[t].task),clearTimeout(e[t].img_task),e[t].task=null,e[t].img_task=null,e[t].status=!0,setTimeout(this.onIntervalTask.bind(this,t),5e3);this.setState({start:!0,list:e})}},{key:"onStopBatchTask",value:function(){var e=this.state.list;for(var t in e)clearInterval(e[t].task),clearTimeout(e[t].img_task),e[t].status=!1,e[t].task=null,e[t].img_task=null;this.setState({start:!1,list:e})}},{key:"onSaveAllConfig",value:function(){var e=this.state.list;e===[]&&0===e.length||(this.handleConfig("update",e),this.onStopBatchTask(),this.onStartBatchTask())}},{key:"handleState",value:function(e,t,a){var n=this.state.list;console.log("i: ",t,"; con: ",n),n[t][e]=a,this.setState({list:n})}},{key:"render",value:function(){var e=this,t=this.state,a=t.list,n=(t.o_list,t.start,t.s_view),l=n?"col-lg-11":"col-lg-9",i=a.map(function(t,a){return c["default"].createElement(g,{key:a,con_data:t,onIntervalTask:e.onIntervalTask.bind(e),index:a})});return c["default"].createElement("section",{className:"wrapper"},c["default"].createElement(k,{s_view:n}),c["default"].createElement("div",{className:l},c["default"].createElement("section",{className:"panel row"},c["default"].createElement("div",{className:"panel-heading"},c["default"].createElement("div",{className:"panel-title"},"二维码")),c["default"].createElement("div",{className:"panel-wrapper"},i))))}}]),t}(u.Component),g=function(e){function t(e){i(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={qrcode:"/img/fail.png",con_data:a.props.con_data,index:a.props.index},a}return s(t,e),o(t,[{key:"onIntervalTask",value:function(e){this.props.onIntervalTask(e)}},{key:"render",value:function(){function e(e){var t=e.getFullYear()+"-",a=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",n=(e.getDate()<10?"0"+e.getDate():e.getDate())+" ",l=(e.getHours()<10?"0"+e.getHours():e.getHours())+":",i=(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":",r=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return t+a+n+l+i+r}var t=this.state,a=t.qrcode,n=t.index,l=t.con_data,i=l.id,r=l.product,s=l.price,o=l.image,u=l.timestamp,d=l.status,m=new Date(parseInt(u)),f=d?"disabled":"";return c["default"].createElement("div",{className:"col-xs-4 col-sm-2 col-lg-1 code-box"},c["default"].createElement("section",{className:"panel row"},c["default"].createElement("div",{className:"panel-heading row"},c["default"].createElement("span",{className:"pull-left"},c["default"].createElement("strong",null,i)," ",h[r]),c["default"].createElement("span",{className:"pull-right text-danger"},c["default"].createElement("strong",null,s))),c["default"].createElement("div",{className:"panel-body form-horizontal"},c["default"].createElement("div",{className:"form-group text-center"},c["default"].createElement("img",{src:o?o:a,className:"img-thumbnail"})),c["default"].createElement("div",{className:"form-group"},c["default"].createElement("h6",null,c["default"].createElement("small",null,u?e(m):"未开始")),d?c["default"].createElement(E,{time:120}):"",c["default"].createElement("div",{className:"input-group input-group-sm"},c["default"].createElement("input",{className:"form-control",type:"text",disabled:"true"}),c["default"].createElement("div",{className:"input-group-btn"},c["default"].createElement("a",{className:"btn btn-primary "+f,onClick:this.onIntervalTask.bind(this,n)},"生成")))))))}}]),t}(u.Component),k=function(e){function t(e){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return s(t,e),o(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.list,n=t.start,l=t.s_view,i=a.map(function(t,a){return c["default"].createElement(b,{key:a,index:a,con_data:t,handleState:e.handleState.bind(e)})}),r=n?c["default"].createElement("a",{className:"btn btn-danger btn-sm",href:"javascript:void(0);",onClick:this.onStopBatchTask.bind(this)},c["default"].createElement("i",{className:"fa fa-stop"})," 全部结束"):c["default"].createElement("a",{className:"btn btn-success btn-sm",href:"javascript:void(0);",onClick:this.onStartBatchTask.bind(this)},c["default"].createElement("i",{className:"fa fa-play"})," 全部开始"),s=c["default"].createElement("div",{className:"col-lg-3"},c["default"].createElement("section",{className:"panel"},c["default"].createElement("div",{className:"panel-heading"},c["default"].createElement("div",{className:"panel-title"},"设置",c["default"].createElement("span",{className:"pull-right"},r))),c["default"].createElement("div",{className:"panel-body row"},i)));return l&&(s=c["default"].createElement("div",{className:"col-lg-1"},c["default"].createElement("section",{className:"panel"},c["default"].createElement("div",{className:"panel-heading"},c["default"].createElement("div",{className:"panel-title"},r)),c["default"].createElement("div",{className:"panel-body row"},i)))),c["default"].createElement("div",null,s)}}]),t}(u.Component),b=function(e){function t(e){i(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={index:a.props.index},a}return s(t,e),o(t,[{key:"onChangeValue",value:function(e,t){var a=this.state.index;this.setState(l({},e,t)),this.props.handleState(e,a,t)}},{key:"onChangeAccount",value:function(e){var t=this.state.index,a=$("account_"+e).val();console.log(a),""!=a?this.props.handleState("account",t,a):alert("输入的数据有误")}},{key:"render",value:function(){var e=this,t=this.props.con_data,a=t.id,n=t.product,l=t.price,i=t.account,r=f.map(function(t,a){return c["default"].createElement("li",{key:a},c["default"].createElement("a",{href:"javascript:void(0);",onClick:e.onChangeValue.bind(e,"product",t.id)},t.name))}),s=p[n].map(function(t,a){return c["default"].createElement("li",{key:a},c["default"].createElement("a",{href:"javascript:void(0);",onClick:e.onChangeValue.bind(e,"price",t.id)},t.name))});return c["default"].createElement("div",{className:"col-sm-12 row margin-bottom5"},c["default"].createElement("div",{className:"col-sm-1"},c["default"].createElement("h5",null,a)),c["default"].createElement("div",{className:"col-sm-11 input-group input-group-sm"},c["default"].createElement("div",{className:"input-group-btn"},c["default"].createElement("button",{type:"button",className:"btn btn-default dropdown-toggle col-sm-12","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},h[n]),c["default"].createElement("ul",{className:"dropdown-menu"},r)),c["default"].createElement("div",{className:"input-group-btn"},c["default"].createElement("button",{type:"button",className:"btn btn-default dropdown-toggle col-sm-12","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},l),c["default"].createElement("ul",{className:"dropdown-menu"},s)),c["default"].createElement("input",{id:"account_"+a,type:"text",className:"form-control input-sm",defaultValue:i}),c["default"].createElement("div",{className:"input-group-btn"},c["default"].createElement("a",{className:"btn btn-success btn-sm",onClick:this.onChangeAccount.bind(this,a)},c["default"].createElement("i",{className:"fa fa-play"})," 开始"))))}}]),t}(u.Component),E=function(e){function t(e){i(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={time:a.props.time},a}return s(t,e),o(t,[{key:"componentDidMount",value:function(){var e=this;this.timerID=setInterval(function(){return e.tick()},1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timerID)}},{key:"tick",value:function(){this.setState({time:this.state.time-1}),this.state.time<=0&&clearInterval(this.timerID)}},{key:"render",value:function(){return c["default"].createElement("h6",null,c["default"].createElement("small",null,this.state.time))}}]),t}(c["default"].Component);m["default"].render(c["default"].createElement(v,null),document.getElementById("main-content"))},{react:"react","react-dom":"react-dom"}]},{},[1]);