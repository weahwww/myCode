!function e(t,a,n){function l(i,o){if(!a[i]){if(!t[i]){var c="function"==typeof require&&require;if(!o&&c)return c(i,!0);if(r)return r(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var s=a[i]={exports:{}};t[i][0].call(s.exports,function(e){var a=t[i][1][e];return l(a?a:e)},s,s.exports,e,t,a,n)}return a[i].exports}for(var r="function"==typeof require&&require,i=0;i<n.length;i++)l(n[i]);return l}({1:[function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),c=e("react"),d=n(c),s=e("react-dom"),u=n(s),m=function(e){function t(){l(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.state={start:!1,config:[{id:"1",product:"",price:"",mobile:"",interval:"600000"}]},e}return i(t,e),o(t,[{key:"componentDidMount",value:function(){this.loadConfig()}},{key:"loadConfig",value:function(){var e=this;$.post("/api/qrcode/config").done(function(t){var a=JSON.parse(t),n=a.status,l=a.data;"ok"===n?e.setState({config:l}):alert("加载配置失败")}).fail(function(){alert("加载配置异常")})}},{key:"loadCode",value:function(){var e=this,t={page:page,status:status,size:size,start:start,end:end};console.log(t),$.post("/api/qrcode/summary",JSON.stringify(t)).done(function(t){var a=JSON.parse(t),n=a.msg,l=a.data;a.max;"ok"===n?e.setState({code:l}):alert("加载二维码错误")}).fail(function(){alert("加载二维码异常")})}},{key:"sendPhonePrice",value:function(e,t,a){var n=this,l=(new Date).getTime(),r={product:a,num:1,phone:e,price:t,timestamp:l};console.log(r),$.post("/api/qrcode/submit",JSON.stringify(r)).done(function(e){var t=JSON.parse(e),a=t.msg;"ok"===a?n.loadCodeList():console.log("发送失败,请稍候再试!")}).fail(function(){console.log("服务器获取信息失败")})}},{key:"onSetCodeState",value:function(e,t){var a=this;$.post("/api/qrcode/callback",JSON.stringify({create_time:e,status:t})).done(function(e){var n=JSON.parse(e),l=n.status;"ok"===l?("used"!==t&&alert("设置成功"),a.loadCodeList()):"used"!==t&&alert("设置失败")}).fail(function(){alert("设置异常")})}},{key:"onStartTask",value:function(){var e=setInterval(this.loadCodeList.bind(this),1e4);this.setState({task:e,refresh:!0})}},{key:"onStopTask",value:function(){var e=this.state.task;clearInterval(e),this.setState({task:null,refresh:!1})}},{key:"onClickStatusBtn",value:function(e){this.setState({cur_tab:e}),this.loadCodeList()}},{key:"onGetQRCode",value:function(e){var t=this.state.code_list,a=[t[e],{title:"取码",code:"getCode"}],n=a[0],l=n.image,r=n.create_time,i=a[1];this.setState({cur_data:{image:l,create_time:r},show_type:i}),this.onSetCodeState(t[e].create_time,"used"),$("#modal").modal("show")}},{key:"onClickCreateNew",value:function(){var e={title:"生成",code:"createNew"};this.setState({show_type:e}),$("#modal").modal("show")}},{key:"getDateRange",value:function(e,t){this.setState({r_start:e,r_end:t})}},{key:"render",value:function(){var e=this,t=this.state,a=t.config,n=t.start,l={running:"生成中",used:"已取码",wait:"未取码",finish:"完成",fail:"失败"},r={running:"text-primary",used:"",wait:"text-danger",finish:"text-success",fail:"text-danger"},i=n?"":"disabled",o=(tab.map(function(t,a){var n="";return t.id===cur_tab&&(n="active"),d["default"].createElement("li",{key:a,role:"presentation",className:n},d["default"].createElement("a",{href:"javascript:void(0);",className:"text-primary","data-toggle":"tab",onClick:e.onClickStatusBtn.bind(e,t.id)},t.name))}),code_list.map(function(t,a){var n=new Date(parseInt(t.create_time)),i=[d["default"].createElement("a",{href:"javascript:void(0);",onClick:e.onGetQRCode.bind(e,a)},"取码"),d["default"].createElement("a",{href:"javascript:void(0);",onClick:e.onSetCodeState.bind(e,t.create_time,"finish")},"置成功"),d["default"].createElement("a",{href:"javascript:void(0);",onClick:e.onSetCodeState.bind(e,t.create_time,"fail")},"置失败"),t.note],o=i[0],c=i[1],s=i[2],u=i[3];return"running"===t.status?(c=null,o=null):"finish"!==t.status&&"fail"!==t.status||(c=null,s=null),d["default"].createElement("tr",{key:a},d["default"].createElement("td",null,t.create_time),d["default"].createElement("td",null,t.name),d["default"].createElement("td",null,formatDate(n)),d["default"].createElement("td",null,t.price),d["default"].createElement("td",null,t.mobile),d["default"].createElement("td",null,t.orderid),d["default"].createElement("td",{className:r[t.status]},l[t.status]),d["default"].createElement("td",null,o),d["default"].createElement("td",null,c," ",s),d["default"].createElement("td",null,u))}));return d["default"].createElement("section",{className:"wrapper"},d["default"].createElement("div",{className:"row"},d["default"].createElement("div",{className:"col-lg-12"},d["default"].createElement("section",{className:"panel"},d["default"].createElement("header",{className:"panel-heading row"},d["default"].createElement("span",{className:"pull-right margin-right10",style:{marginBottom:"-5px"}},d["default"].createElement("a",{className:"btn btn-success btn-sm "+i,href:"javascript:void(0);",onClick:this.onStartTask.bind(this)},d["default"].createElement("i",{className:"fa fa-play"})," 开始"),d["default"].createElement("a",{href:"javascript:void(0);",className:"btn btn-primary btn-sm",onClick:this.onClickCreateNew.bind(this)},d["default"].createElement("i",{className:"fa fa-plus fa-lg"})))),d["default"].createElement("div",{className:"panel-body table-responsive"},d["default"].createElement("table",{id:"order_result",className:"table table-striped table-hover"},d["default"].createElement("thead",null,d["default"].createElement("tr",null,d["default"].createElement("th",null,"编号"),d["default"].createElement("th",null,"产品名称"),d["default"].createElement("th",null,"提交时间"),d["default"].createElement("th",null,"面值"),d["default"].createElement("th",null,"号码"),d["default"].createElement("th",null,"订单编号"),d["default"].createElement("th",null,"二维码状态"),d["default"].createElement("th",null,"取码"),d["default"].createElement("th",null,"订单操作"),d["default"].createElement("th",null,"备注"))),d["default"].createElement("tbody",null,o)))),d["default"].createElement(f,{config:a,onSetConfig:this.onSetConfig.bind(this)}))))}}]),t}(d["default"].Component),f=(function(e){function t(e){l(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={qrcode:"/img/fail.png"},a}return i(t,e),t}(d["default"].Component),function(e){function t(e){l(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={product:[{id:"fee_slow",name:"全国话费慢充"},{id:"jyk",name:"加油卡"},{id:"service_jyk",name:"客服加油卡"}],price:{fee_slow:[{id:"100",name:"100"},{id:"200",name:"200"},{id:"300",name:"300"},{id:"500",name:"500"},{id:"1000",name:"1000"},{id:"2000",name:"2000"},{id:"3000",name:"3000"},{id:"4000",name:"4000"},{id:"5000",name:"5000"},{id:"10000",name:"10000"}],jyk:[{id:"1000",name:"1000"},{id:"2000",name:"2000"},{id:"3000",name:"3000"},{id:"4000",name:"4000"},{id:"5000",name:"5000"},{id:"6000",name:"6000"},{id:"7000",name:"7000"},{id:"8000",name:"8000"},{id:"9000",name:"9000"},{id:"10000",name:"10000"}],service_jyk:[{id:"500",name:"500"},{id:"1000",name:"1000"},{id:"3000",name:"3000"},{id:"5000",name:"5000"},{id:"10000",name:"10000"},{id:"20000",name:"20000"}]},cur_product:"service_jyk",cur_price:"500"},a}return i(t,e),o(t,[{key:"onSelectProduct",value:function(){var e="fee_slow"===product_active?"100":"1000";this.setState({product_active:product_active,price_active:e,mobile:""})}},{key:"onSelectPrice",value:function(e){this.setState({price_active:e})}},{key:"sendPhonePrice",value:function(){var e=this.state,t=e.mobile,a=e.product_active,n=e.price_active,l=t,r=a,i=n;return console.log(l,", ",i,", ",r),""===l?(alert("号码格式错误,请重新输入!"),!1):!!window.confirm("确认生成二维码吗?")&&(this.props.sendPhonePrice(l,i,r),void $("#modal").modal("hide"))}},{key:"onCancel",value:function(){this.setState({mobile:null,product_active:"fee_slow",price_active:"100"}),$("#modal").modal("hide")}},{key:"onMobileChange",value:function(e){console.log(e.target.value),this.setState({mobile:e.target.value})}},{key:"onSelectUsedMobile",value:function(e){this.setState({mobile:e})}},{key:"getRandomPhone",value:function(){for(var e=["139","138","137","136","135","134","159","158","157","150","151","152","188","187","182","183","184","178","130","131","132","156","155","186","185","176","133","153","189","180","181","177"],t=parseInt(10*Math.random()),a=e[t],n=0;n<8;n++)a+=Math.floor(10*Math.random());this.setState({mobile:a})}},{key:"render",value:function(){var e=this,t=this.props,a=t.cur_data,n=a.image,l=a.create_time,r=t.show_type,i=r.title,o=r.code,c=this.state,s=c.used_mobile,u=c.product,m=c.price,f=c.mobile,p=c.product_active,h=c.price_active,v=c.def_img,b=d["default"].createElement("div",{className:"text-center"},d["default"].createElement("img",{src:n?n:v,className:"img-thumbnail"}),d["default"].createElement("h5",null,l)),E="",g=u.map(function(t,a){var n=p===t.id?"btn-primary":"btn-default";return d["default"].createElement("div",{className:"col-sm-4 margin-bottom15"},d["default"].createElement("a",{key:a,href:"javascript:void(0);",className:"btn btn-block "+n,onClick:e.onSelectProduct.bind(e,t.id)},t.name))}),y=m[p].map(function(t,a){var n=h===t.id?"btn-primary":"btn-default";return d["default"].createElement("div",{className:"col-sm-3 margin-bottom15"},d["default"].createElement("a",{key:a,href:"javascript:void(0);",className:"btn btn-block "+n,onClick:e.onSelectPrice.bind(e,t.id)},t.name))}),_=d["default"].createElement("input",{type:"text",className:"form-control",value:f,defaultValue:f,placeholder:"输入充值的帐号",onChange:this.onMobileChange.bind(this)});if("fee_slow"===p){var k=s.map(function(t,a){return d["default"].createElement("li",{key:a},d["default"].createElement("a",{href:"javascript:void(0);",onClick:e.onSelectUsedMobile.bind(e,t.id)},t.name))});_=d["default"].createElement("div",{className:"input-group"},d["default"].createElement("div",{className:"input-group-btn"},d["default"].createElement("a",{type:"button",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},d["default"].createElement("i",{className:"fa fa-caret-down"})),d["default"].createElement("ul",{className:"dropdown-menu dropdown-menu-right"},k)),d["default"].createElement("input",{type:"text",className:"form-control",value:f,defaultValue:f,placeholder:"输入充值的帐号",onChange:this.onMobileChange.bind(this)}),d["default"].createElement("div",{className:"input-group-btn"},d["default"].createElement("button",{className:"btn btn-default",type:"button",onClick:this.getRandomPhone.bind(this)},"随机")))}return"createNew"===o&&(b=d["default"].createElement("div",{className:"form-group"},d["default"].createElement("label",{className:"col-sm-4 col-md-2 control-label"},"产品"),d["default"].createElement("div",{className:"col-sm-8 col-md-10 row"},g),d["default"].createElement("label",{className:"col-sm-4 col-md-2 control-label"},"充值帐号"),d["default"].createElement("div",{className:"col-sm-8 col-md-10 margin-bottom15"},_),d["default"].createElement("label",{className:"col-sm-4 col-md-2 control-label"},"面值"),d["default"].createElement("div",{className:"col-sm-8 col-md-10 row"},y)),E=d["default"].createElement("a",{className:"btn btn-primary",onClick:this.sendPhonePrice.bind(this)},"生成")),d["default"].createElement("div",{className:"modal fade",id:"modal",tabIndex:"-1",role:"dialog","aria-labelledby":"addModalLabel","data-backdrop":"static"},d["default"].createElement("div",{className:"modal-dialog"},d["default"].createElement("div",{className:"modal-content"},d["default"].createElement("div",{className:"modal-header"},d["default"].createElement("h4",{className:"modal-title"},i)),d["default"].createElement("div",{className:"modal-body form-horizontal"},b),d["default"].createElement("div",{className:"modal-footer"},E,d["default"].createElement("a",{className:"btn btn-default","data-dismiss":"modal",onClick:this.onCancel.bind(this)},"关闭")))))}}]),t}(d["default"].Component));u["default"].render(d["default"].createElement(m,null),document.getElementById("main-content"))},{react:"react","react-dom":"react-dom"}]},{},[1]);