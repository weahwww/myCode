!function e(t,a,n){function l(i,s){if(!a[i]){if(!t[i]){var o="function"==typeof require&&require;if(!s&&o)return o(i,!0);if(r)return r(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var c=a[i]={exports:{}};t[i][0].call(c.exports,function(e){var a=t[i][1][e];return l(a?a:e)},c,c.exports,e,t,a,n)}return a[i].exports}for(var r="function"==typeof require&&require,i=0;i<n.length;i++)l(n[i]);return l}({1:[function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),d=e("react"),c=n(d),u=e("react-dom"),m=n(u),f=[{id:"fee_slow",name:"全国话费慢充"},{id:"jyk",name:"加油卡"},{id:"service_jyk",name:"客服加油卡"}],p={fee_slow:[{id:"100",name:"100"},{id:"200",name:"200"},{id:"300",name:"300"},{id:"500",name:"500"},{id:"1000",name:"1000"},{id:"2000",name:"2000"},{id:"3000",name:"3000"},{id:"4000",name:"4000"},{id:"5000",name:"5000"},{id:"10000",name:"10000"}],jyk:[{id:"1000",name:"1000"},{id:"2000",name:"2000"},{id:"3000",name:"3000"},{id:"4000",name:"4000"},{id:"5000",name:"5000"},{id:"6000",name:"6000"},{id:"7000",name:"7000"},{id:"8000",name:"8000"},{id:"9000",name:"9000"},{id:"10000",name:"10000"}],service_jyk:[{id:"500",name:"500"},{id:"1000",name:"1000"},{id:"3000",name:"3000"},{id:"5000",name:"5000"},{id:"10000",name:"10000"},{id:"20000",name:"20000"}]},h={fee_slow:"全国话费慢充",jyk:"加油卡",service_jyk:"客服加油卡"},v=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.state={start:!1,list:[]},e.handleConfig("all"),e}return s(t,e),o(t,[{key:"handleSubmitData",value:function(e){var t=this,a=this.state.list;a[e].timestamp=(new Date).getTime(),$.post("/api/qrcode/submit",JSON.stringify(a[e])).done(function(n){console.log(n);var l=JSON.parse(n),r=l.status,i=l.order_id;"ok"===r?(a[e].order_id=i,a[e].status=!0,clearTimeout(a[e].img_task),a[e].img_task=null,t.loadCodeImage(e,i),t.setState({list:a})):alert("创建订单失败")}).fail(function(){alert("创建订单异常")})}},{key:"handleConfig",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state.list;$.post("/api/qrcode/config",JSON.stringify({type:e,data:a})).done(function(e){var a=JSON.parse(e),n=a.status,l=a.data;return"ok"!==n?(alert("加载配置失败"),!1):void t.setState({list:l})}).fail(function(){return alert("加载配置异常"),!1})}},{key:"loadCodeImage",value:function(e,t){var a=this,n=this.state.list,l=null;$.post("/api/qrcode/qrcode_get",JSON.stringify({order_id:t})).done(function(r){var i=JSON.parse(r),s=i.status,o=i.image;return"ok"===s?(n[e].image=o,n[e].status=!1,a.setState({list:n}),!1):(l=setTimeout(a.loadCodeImage.bind(a,e,t),3e4),n[e].img_task=l,a.setState({list:n}),void 0)}).fail(function(){return alert("获取图片异常"),!1})}},{key:"onClearInterval",value:function(e){var t=this.state.list;clearInterval(t[e].task),clearTimeout(t[e].img_task),t[e].task=null,t[e].img_task=null,t[e].status=!1,console.log("CleanInterval: ",t),this.setState({list:t})}},{key:"onIntervalTask",value:function(e){var t=this.state.list;this.handleSubmitData(e),t[e].task=setInterval(this.handleSubmitData.bind(this,e),1e5),console.log("Interval: ",t),this.setState({start:!0,list:t})}},{key:"onStartBatchTask",value:function(){var e=this.state.list;for(var t in e)e[t].status=!0,setTimeout(this.onIntervalTask.bind(this,t),5e3);console.log("StartBatch: ",e),this.setState({list:e})}},{key:"onStopBatchTask",value:function(){var e=this.state.list;for(var t in e)clearInterval(e[t].task),clearTimeout(e[t].img_task),e[t].status=!1,e[t].task=null,e[t].img_task=null;console.log("StopBatch: ",e),this.setState({start:!1,list:e})}},{key:"render",value:function(){var e=this,t=function(){$("#modal").modal("show")},a=this.state,n=a.list,l=a.start,r=l?c["default"].createElement("a",{className:"btn btn-danger btn-sm",href:"javascript:void(0);",onClick:this.onStopBatchTask.bind(this)},c["default"].createElement("i",{className:"fa fa-stop"})," 结束"):c["default"].createElement("a",{className:"btn btn-success btn-sm",href:"javascript:void(0);",onClick:this.onStartBatchTask.bind(this)},c["default"].createElement("i",{className:"fa fa-play"})," 开始"),i=n.map(function(t,a){return c["default"].createElement(g,{key:a,data:t,onIntervalTask:e.onIntervalTask.bind(e),index:a})});return c["default"].createElement("section",{className:"wrapper"},c["default"].createElement("div",{className:"row"},c["default"].createElement("div",{className:"col-lg-12"},c["default"].createElement("section",{className:"panel row"},c["default"].createElement("div",{className:"panel-body"},c["default"].createElement("span",{className:"pull-right margin-right10",style:{marginBottom:"-5px"}},r,c["default"].createElement("a",{href:"javascript:void(0);",className:"btn btn-primary btn-sm",onClick:t.bind(this)},c["default"].createElement("i",{className:"fa fa-cog fa-lg"}))))))),c["default"].createElement("div",{className:"row"},i),c["default"].createElement(b,{list:n,onClearInterval:this.onClearInterval.bind(this),onIntervalTask:this.onIntervalTask.bind(this),onStartBatchTask:this.onStartBatchTask.bind(this),onStopBatchTask:this.onStopBatchTask.bind(this),handleConfig:this.handleConfig.bind(this)}))}}]),t}(d.Component),g=function(e){function t(e){r(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={qrcode:"/img/fail.png",data:a.props.data,index:a.props.index},a}return s(t,e),o(t,[{key:"onIntervalTask",value:function(e){this.props.onIntervalTask(e)}},{key:"render",value:function(){function e(e){var t=e.getFullYear()+"-",a=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",n=(e.getDate()<10?"0"+e.getDate():e.getDate())+" ",l=(e.getHours()<10?"0"+e.getHours():e.getHours())+":",r=(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":",i=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return t+a+n+l+r+i}var t=this.state,a=t.qrcode,n=t.index,l=t.data,r=l.product,i=l.price,s=l.image,o=l.timestamp,d=l.status,u=new Date(parseInt(o)),m=d?"disabled":"";return c["default"].createElement("div",{className:"col-xs-4 col-sm-2 col-lg-1 code-box"},c["default"].createElement("section",{className:"panel row"},c["default"].createElement("header",{className:"panel-heading row"},c["default"].createElement("span",{className:"pull-left"},h[r]),c["default"].createElement("span",{className:"pull-right text-danger"},c["default"].createElement("strong",null,i))),c["default"].createElement("div",{className:"panel-body form-horizontal"},c["default"].createElement("div",{className:"form-group text-center"},c["default"].createElement("img",{src:s?s:a,className:"img-thumbnail"})),c["default"].createElement("div",{className:"form-group"},c["default"].createElement("h6",null,c["default"].createElement("small",null,o?e(u):"未开始")),c["default"].createElement("div",{className:"input-group input-group-sm"},c["default"].createElement("input",{className:"form-control",type:"text",disabled:"true"}),c["default"].createElement("div",{className:"input-group-btn"},c["default"].createElement("a",{className:"btn btn-primary "+m,onClick:this.onIntervalTask.bind(this,n)},"生成")))))))}}]),t}(d.Component),b=function(e){function t(e){r(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={data:[]},a}return s(t,e),o(t,[{key:"onSaveAllConfig",value:function(){var e=this.state.data;e===[]&&0===e.length||(this.props.handleConfig("update",e),this.props.onStopBatchTask(),this.props.onStartBatchTask())}},{key:"handleState",value:function(e,t,a){var n=this.props.list;n[t][e]=a,this.setState({data:n})}},{key:"onCancel",value:function(){this.props.handleConfig("all"),$("#modal").modal("hide")}},{key:"render",value:function(){var e=this,t=this.props.list,a=t.map(function(t,a){return c["default"].createElement(k,{key:a,index:a,data:t,handleConfig:e.props.handleConfig.bind(e),onClearInterval:e.props.onClearInterval.bind(e),onIntervalTask:e.props.onIntervalTask.bind(e),handleState:e.handleState.bind(e)})});return c["default"].createElement("div",{className:"modal fade",id:"modal",tabIndex:"-1",role:"dialog","aria-labelledby":"addModalLabel","data-backdrop":"static"},c["default"].createElement("div",{className:"modal-dialog"},c["default"].createElement("div",{className:"modal-content"},c["default"].createElement("div",{className:"modal-header"},c["default"].createElement("h4",{className:"pull-left"},"设置"),c["default"].createElement("span",{className:"pull-right"},c["default"].createElement("a",{href:"javascript:void(0);",className:"btn btn-primary btn-sm",onClick:this.onSaveAllConfig.bind(this)},"全部保存"))),c["default"].createElement("div",{className:"modal-body row"},a),c["default"].createElement("div",{className:"modal-footer"},c["default"].createElement("a",{className:"btn btn-default","data-dismiss":"modal",onClick:this.onCancel.bind(this)},"关闭")))))}}]),t}(d.Component),k=function(e){function t(e){r(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={data:a.props.data,index:a.props.index},a}return s(t,e),o(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({data:e.data,index:e.index})}},{key:"onChangeValue",value:function(e,t){var a=this.state.index;this.setState(l({},e,t)),this.props.handleState(e,a,t)}},{key:"onChangeAccount",value:function(e){var t=this.state.index,a=e.target.value;this.props.handleState("account",t,a)}},{key:"onSaveConfig",value:function(){var e=this.state,t=e.index,a=e.data,n=[];n[0]=a,this.props.handleConfig("update",n),this.props.onClearInterval(t),this.props.onIntervalTask(t)}},{key:"render",value:function(){var e=this,t=this.state.data,a=t.id,n=t.product,l=t.price,r=t.account,i=f.map(function(t,a){return c["default"].createElement("li",{key:a},c["default"].createElement("a",{href:"javascript:void(0);",onClick:e.onChangeValue.bind(e,"product",t.id)},t.name))}),s=p[n].map(function(t,a){return c["default"].createElement("li",{key:a},c["default"].createElement("a",{href:"javascript:void(0);",onClick:e.onChangeValue.bind(e,"price",t.id)},t.name))});return c["default"].createElement("div",{className:"col-sm-12 row margin-bottom5"},c["default"].createElement("div",{className:"col-sm-1"},c["default"].createElement("h5",null,a)),c["default"].createElement("div",{className:"col-sm-11 input-group input-group-sm"},c["default"].createElement("div",{className:"input-group-btn"},c["default"].createElement("button",{type:"button",className:"btn btn-default dropdown-toggle col-sm-12","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},h[n]),c["default"].createElement("ul",{className:"dropdown-menu"},i)),c["default"].createElement("div",{className:"input-group-btn"},c["default"].createElement("button",{type:"button",className:"btn btn-default dropdown-toggle col-sm-12","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},l),c["default"].createElement("ul",{className:"dropdown-menu"},s)),c["default"].createElement("input",{type:"text",className:"form-control input-sm",defaultValue:r,onChange:this.onChangeAccount.bind(this)}),c["default"].createElement("div",{className:"input-group-btn"},c["default"].createElement("button",{type:"button",className:"btn btn-default",onClick:this.onSaveConfig.bind(this)},"保存"))))}}]),t}(d.Component);m["default"].render(c["default"].createElement(v,null),document.getElementById("main-content"))},{react:"react","react-dom":"react-dom"}]},{},[1]);